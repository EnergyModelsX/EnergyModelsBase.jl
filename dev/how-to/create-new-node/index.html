<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Create a new node Â· EnergyModelsBase</title><meta name="title" content="Create a new node Â· EnergyModelsBase"/><meta property="og:title" content="Create a new node Â· EnergyModelsBase"/><meta property="twitter:title" content="Create a new node Â· EnergyModelsBase"/><meta name="description" content="Documentation for EnergyModelsBase."/><meta property="og:description" content="Documentation for EnergyModelsBase."/><meta property="twitter:description" content="Documentation for EnergyModelsBase."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsBase</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/quick-start/">Quick Start</a></li><li><a class="tocitem" href="../../manual/philosophy/">Philosophy</a></li><li><a class="tocitem" href="../../manual/optimization-variables/">Optimization variables</a></li><li><a class="tocitem" href="../../manual/constraint-functions/">Constraint functions</a></li><li><a class="tocitem" href="../../manual/data-functions/">Data functions</a></li><li><a class="tocitem" href="../../manual/simple-example/">Example</a></li><li><a class="tocitem" href="../../manual/investments/">Investment options</a></li><li><a class="tocitem" href="../../manual/NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">Nodes</span><ul><li><a class="tocitem" href="../../nodes/source/">Source</a></li><li><a class="tocitem" href="../../nodes/networknode/">NetworkNode</a></li><li><a class="tocitem" href="../../nodes/storage/">Storage</a></li><li><a class="tocitem" href="../../nodes/sink/">Sink</a></li><li><a class="tocitem" href="../../nodes/availability/">Availability</a></li></ul></li><li><span class="tocitem">How to</span><ul><li class="is-active"><a class="tocitem" href>Create a new node</a><ul class="internal"><li><a class="tocitem" href="#how_to-create_node-tips"><span>Additional tips for creating new nodes</span></a></li><li><a class="tocitem" href="#how_to-create_node-adv"><span>Advanced creation of new nodes</span></a></li><li><a class="tocitem" href="#how_to-create_node-subtype"><span>What abstract node type should you subtype to?</span></a></li><li><a class="tocitem" href="#how_to-create_node-example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../utilize-timestruct/">Utilize TimeStruct</a></li><li><a class="tocitem" href="../update-models/">Update models</a></li><li><a class="tocitem" href="../contribute/">Contribute to EnergyModelsBase</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">Public</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/public/resources/">Resources</a></li><li><a class="tocitem" href="../../library/public/model_data/">Modeltype and Data</a></li><li><a class="tocitem" href="../../library/public/nodes/">Nodes</a></li><li><a class="tocitem" href="../../library/public/links/">Links</a></li><li><a class="tocitem" href="../../library/public/functions/">Functions</a></li><li><a class="tocitem" href="../../library/public/misc/">Miscellaneous</a></li><li><a class="tocitem" href="../../library/public/emi_extension/">EMI extension</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Internal</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/internals/types/">Types</a></li><li><a class="tocitem" href="../../library/internals/functions/">Functions</a></li><li><a class="tocitem" href="../../library/internals/reference_EMIExt/">EMI extension</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to</a></li><li class="is-active"><a href>Create a new node</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Create a new node</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsBase.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsBase.jl/blob/main/docs/src/how-to/create-new-node.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="how_to-create_node"><a class="docs-heading-anchor" href="#how_to-create_node">Create a new node</a><a id="how_to-create_node-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-create_node" title="Permalink"></a></h1><p>The energy system model is based on the <em><a href="https://jump.dev/JuMP.jl/">JuMP</a></em> optimization framework, so some basic knowledge on this Julia package is needed to implement a new technology node.</p><blockquote><p><strong>To create a new technology node named <code>NewTechNode</code>, we need to</strong></p><ol><li><p>Implement a new <code>struct</code> (composite type), that is a subtypes of <code>Node</code>, <code>Source</code>, <code>Sink</code>, etc. Here, a central choice is to decide on <a href="#how_to-create_node-subtype"><em>what abstract node type to subtype to</em></a>.</p></li><li><p>Optional: implement the method</p><pre><code class="language-julia hljs">variables_node(m, ğ’©Ë¢áµ˜áµ‡::Vector{&lt;:NewTechNode}, ğ’¯, modeltype::EnergyModel)</code></pre><p>Implement this method if you want to create additional optimization variables for the new node. See <em><a href="https://jump.dev/JuMP.jl/stable/manual/variables/">how to create JuMP variables</a></em> in the JuMP documentation.</p></li><li><p>Implement the method</p><pre><code class="language-julia hljs">create_node(m, n::NewTechNode, ğ’¯, ğ’«, modeltype::EnergyModel)</code></pre><p>In this method the constraints for the new node are created. See <em><a href="https://jump.dev/JuMP.jl/stable/manual/constraints/">how to create JuMP constraints</a></em> in the JuMP documentation.</p></li></ol></blockquote><p>While step 1 is always required, it is possible to omit step 2 if no new variables are required. It is also possible to create unregistered variables for each instance of the node. This is however only advised if you do not need to access the value of the variables after the optimization.</p><div class="admonition is-danger"><header class="admonition-header">Variable names</header><div class="admonition-body"><p>By default, it is not possible to use the same variable name twice within JuMP. I found some weird behavior in which it is possible to register the same variable name with a different node set, but it should not be possible to count on it. If you require variables, it is crucial to check whether the variable names are already utilized by other nodes you are using! The individual variables are shown on the description of individual nodes.</p><p>It is hence in general advisable to provide a specific name including the node type as prefix, <em>e.g.</em>, <code>node_test_flow_in if you want to create a variable for a</code>NodeTest`.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Field names</header><div class="admonition-body"><p>When creating a new node type, you are free to change the field names to whatever name you desire. However, if you change the  field names, there are several things to consider:</p><ol><li>Certain functions are used within the core structure of the code for accessing the fields. These functions can be found in the <em><a href="../../library/public/nodes/#lib-pub-nodes-fun_field">Public Interface</a></em>.</li><li>The function <a href="../../library/internals/functions/#EnergyModelsBase.check_node"><code>EMB.check_node</code></a> conducts some checks on the individual node data. If the fields and structure from the reference nodes are not present, you also have to create a new function for your node.</li></ol></div></div><h2 id="how_to-create_node-tips"><a class="docs-heading-anchor" href="#how_to-create_node-tips">Additional tips for creating new nodes</a><a id="how_to-create_node-tips-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-create_node-tips" title="Permalink"></a></h2><ol><li>If the <code>NewNodeType</code> should be able to include investments, it is necessary to i) call the function <a href="../../library/internals/reference_EMIExt/#EnergyModelsBase.constraints_capacity_installed-Tuple{Any, EnergyModelsBase.Node, TimeStructure, AbstractInvestmentModel}"><code>constraints_capacity_installed</code></a>. and ii) have the field <code>data</code>. The function is used for dispatching on the constraints for investments while the field <code>data</code> is used for providing the <code>InvestmentData</code>.</li><li>Emissions can be included in any way. It is however beneficial to reutilize the <a href="../../library/public/model_data/#EnergyModelsBase.EmissionsData"><code>EmissionsData</code></a> type to improve usability with other packages. This requries again the inclusion of the field <code>data</code> in <code>NewNodeType</code>. It is possible to also create new subtypes for <code>EmissionsData</code> as well as dispatch on the function <a href="../../manual/data-functions/#man-data_fun"><code>constraints_data(m, n::Node, ğ’¯, ğ’«, modeltype, data::Data)</code></a>.</li><li>It is in a first stage not important to include functions for handling all possible <code>TimeStructure</code>s, that is, <em>e.g.</em>, <code>RepresentativePeriods</code>. Instead, and error can be provided if an unsupported <code>TimeStructure</code> is chosen.</li><li>The existing reference nodes and their respective <em><a href="../../manual/constraint-functions/#man-con">constraint functions</a></em> can serve as idea generators.</li><li>It is possible to include constraints that are coupled to another <code>Node</code> by introduing a field with the <code>Node</code> as type in the <code>NewNodeType</code>, <em>e.g.</em>, a field <code>node::Storage</code> when you plan to include additional constraints including a <code>Storage</code> node.</li><li><code>EnergyModelsBase</code> utilize functions for accessing the fields of the individual nodes. These functions can be found in <em><a href="../../library/public/nodes/#lib-pub-nodes-fun_field">Functions for accessing fields of <code>Node</code> types</a></em>. In general, these functions dispatch on <code>abstract type</code>s.</li><li>It is beneficial to include the fields <code>input</code> and <code>output</code> for the <code>NewTechNode</code>. This is not strictly required, but otherwise one has to provide new methods for the functions <a href="../../library/public/nodes/#EnergyModelsBase.inputs"><code>inputs()</code></a> and  <a href="../../library/public/nodes/#EnergyModelsBase.outputs"><code>outputs()</code></a>.</li></ol><h2 id="how_to-create_node-adv"><a class="docs-heading-anchor" href="#how_to-create_node-adv">Advanced creation of new nodes</a><a id="how_to-create_node-adv-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-create_node-adv" title="Permalink"></a></h2><p>Step 3 in the procedure is not necessarily required. It is also possible to use the available <em><a href="../../manual/constraint-functions/#man-con">constraint functions</a></em> for the new node type. In this case, we have to first obtain an overview over the constraint functions called in</p><pre><code class="language-julia hljs">create_node(m, n::ParentNode, ğ’¯, ğ’«, modeltype::EnergyModel)</code></pre><p>in which <code>ParentNode</code> corresponds to the <code>abstract type</code> that is used as parent for the new <code>NewTechNode</code>. Subsequently, we can add a method to the existing <em>constraint function</em> which is called by the <code>ParentNode</code>. This <em>constraint function</em> has to dispatch on the created <code>NewTechNode</code> type.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>It is in general advised to create a new function <em><code>create_node(m, n::NewTechNode, ğ’¯, ğ’«, modeltype::EnergyModel)</code></em>. The advantage here is that the user requires less understanding of the individual constraint functions. This may lead to repetetive code, but is the safer choice.</p></div></div><h2 id="how_to-create_node-subtype"><a class="docs-heading-anchor" href="#how_to-create_node-subtype">What abstract node type should you subtype to?</a><a id="how_to-create_node-subtype-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-create_node-subtype" title="Permalink"></a></h2><p>The choice of node supertype depends on what optimization variables you need for the constraints describing the functionality of the new node.</p><p>A new node is defined as a composite type (<code>struct</code>) and subtype of one of the standard node types,</p><ul><li><a href="../../manual/optimization-variables/#Source"><code>Source</code></a></li><li><a href="../../library/public/nodes/#EnergyModelsBase.NetworkNode"><code>NetworkNode</code></a></li><li><a href="../../manual/optimization-variables/#Sink"><code>Sink</code></a></li></ul><p>Furthermore, we have the types</p><ul><li><a href="../../library/public/nodes/#EnergyModelsBase.Availability"><code>Availability</code></a> <code>&lt;: NetworkNode</code></li><li><a href="../../manual/optimization-variables/#Storage"><code>Storage</code></a> <code>&lt;: NetworkNode</code></li></ul><p>which correspond to a routing node (<code>Availability</code>) and a storage node (<code>Storage</code>).</p><p>The overall structure of the individual nodes can be printed to the REPL using the following code:</p><pre><code class="language-julia hljs">julia&gt; using EnergyModelsBase
julia&gt; const EMB = EnergyModelsBase
julia&gt; using AbstractTrees
julia&gt; AbstractTrees.children(x::Type) = subtypes(x)

julia&gt; print_tree(EMB.Node)</code></pre><pre><code class="language-REPL hljs">Node
â”œâ”€ NetworkNode
â”‚  â”œâ”€ Availability
â”‚  â”‚  â””â”€ GenAvailability
â”‚  â”œâ”€ RefNetworkNode
â”‚  â””â”€ Storage
â”‚     â””â”€ RefStorage
â”œâ”€ Sink
â”‚  â””â”€ RefSink
â””â”€ Source
   â””â”€ RefSource</code></pre><p>The leaf nodes of the above type hierarchy tree are <code>composite type</code>s, while the inner vertices are <code>abstract type</code>s. The chosen parent <code>type</code> of the <code>NewNodeType</code> node decides what optimization variables are created for use by default. You can find the created default optimization variables in <em><a href="../../manual/optimization-variables/#man-opt_var">Optimization Variables</a></em> and <em><a href="../../manual/optimization-variables/#man-opt_var-node">Node types and respective variables</a></em>. The main difference between the individual parent types is whether they have only an energy/mass output (<code>Source</code>), input and output (<code>NetworkNode</code>), or input (<code>Sink</code>). A more detailed explanation of the different <code>abstract type</code>s can be found in <em><a href="../../manual/philosophy/#man-phil-nodes">Description of Technologies</a></em></p><h2 id="how_to-create_node-example"><a class="docs-heading-anchor" href="#how_to-create_node-example">Example</a><a id="how_to-create_node-example-1"></a><a class="docs-heading-anchor-permalink" href="#how_to-create_node-example" title="Permalink"></a></h2><p>As an example, you can check out how <a href="https://energymodelsx.github.io/EnergyModelsRenewableProducers.jl/"><code>EnergyModelsRenewableProducers</code></a> introduces two new technology types, a <code>Source</code> and a <code>Storage</code>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../nodes/availability/">Â« Availability</a><a class="docs-footer-nextpage" href="../utilize-timestruct/">Utilize TimeStruct Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 7 October 2024 13:54">Monday 7 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
